process Efficiency = {

  include "FWCore/MessageLogger/data/MessageLogger.cfi"
  include "ElectroWeakAnalysis/ZReco/data/mcTruthForDimuons.cff"
  include "ElectroWeakAnalysis/ZReco/data/dimuonsHLTFilter.cfi"

  source = PoolSource {
    untracked vstring fileNames = {
//	"file:skimmedZmm_test.root"
	"file:/tmp/piccolo/dimuons_job1.root"  
	}
}

  untracked PSet maxEvents = {
    untracked int32 input = -1
  }

  service = TFileService { 
    string fileName ="Efficiency1.root"
  }

  module globalPatMuons = CandViewRefSelector {
    InputTag src = selectedLayer1Muons
    string cut = "isGlobalMuon = 1"
  }

  module standAlonePatMuons = CandViewRefSelector {
    InputTag src = selectedLayer1Muons
    string cut = "isGlobalMuon = 0 & isStandAloneMuon = 1"
  }

  block zSelection = {
    string cut = "charge = 0 & daughter(0).pt > 20 & daughter(1).pt > 20 & abs(daughter(0).eta)<2 & abs(daughter(1).eta)<2 & mass > 20"	
 
 }
 
  module zToMuMu = CandViewRefSelector {
    InputTag src = dimuonsGlobal
    string cut = " "
#    using zSelection
#    bool filter = true
  }

  module zToMuMuOneTrack = CandViewRefSelector {
    InputTag src = dimuonsOneTrack
    string cut = "daughter(0).isGlobalMuon = 1"
  }

  module zToMuMuOneStandAloneMuon = CandViewRefSelector {
    InputTag src = dimuonsOneStandAloneMuon
    string cut = " "
  }

  module zMuMuEfficiency = ZMuMuEfficiency {
    InputTag muons = globalPatMuons
    InputTag tracks = goodTracks		
    InputTag standAlone = standAlonePatMuons
    InputTag zMuMu = zToMuMu
    InputTag zMuTrack = zToMuMuOneTrack
    InputTag zMuStandAlone = zToMuMuOneStandAloneMuon
    InputTag muonIso = muonIsolations
    InputTag trackIso = muonIsolations
    InputTag standAloneIso = muonIsolations
    InputTag goldenMuMap = goodMuonMCMatch
    InputTag muonMatchMap = goodMuonMCMatch
    InputTag zMuMuMatchMap = allDimuonsMCMatch
    InputTag zMuTrackMatchMap = allDimuonsMCMatch
    InputTag zMuStandAloneMatchMap = allDimuonsMCMatch
    InputTag genParticles = genParticles 
   
    bool MuonEfficiency = true
    bool TrackerEfficiency = true

    untracked double isomax = 3
    untracked double ptmin = 20.0
    untracked double ptSTAcut = 20.0
    untracked double etamax = 2.0
    untracked double zMassMin= 20.0
    untracked double zMassMax= 200.0
    untracked uint32 nbinsPt = 9
    untracked uint32 nbinsEta = 10
 }

   module eventInfo = AsciiOutputModule { 
#     untracked uint32 prescale = 1000
   }

   path p = {
	dimuonsHLTFilter,	
        mcTruthForDimuons,
	globalPatMuons,
	standAlonePatMuons,
	zToMuMu,
	zToMuMuOneStandAloneMuon,
	zToMuMuOneTrack,
	zMuMuEfficiency}

   endpath e = { 
     eventInfo 
   }
}
